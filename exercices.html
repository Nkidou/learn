<script>
const lettres = ['ا', 'ب', 'ت', 'ث', 'ج', 'ح', 'خ', 'د', 'ذ', 'ر', 'ز', 'س', 'ش', 'ص', 'ض', 'ط', 'ظ', 'ع', 'غ', 'ف', 'ق', 'ك', 'ل', 'م', 'ن', 'هـ', 'و', 'ي'];
let niveau = '';
let questions = [];
let index = 0;
let bonnesReponses = 0;
let timer; // pour le chrono

function startGame(selectedNiveau) {
  niveau = selectedNiveau;
  document.getElementById('menu').style.display = 'none';
  document.getElementById('jeu').style.display = 'block';
  questions = []; // réinitialiser les questions
  index = 0;
  bonnesReponses = 0;
  genererQuestions();
  afficherQuestion();
}

function genererQuestions() {
  let copyLettres;

  if (niveau === 'facile') {
    copyLettres = ['ا', 'ب', 'ت', 'م', 'ن', 'و', 'ي', 'ل'];
  } else if (niveau === 'moyen') {
    copyLettres = ['س', 'ش', 'ص', 'ض', 'ذ', 'ز', 'ج', 'ح', 'خ', 'د'];
  } else {
    copyLettres = ['غ', 'ع', 'ط', 'ظ', 'ق', 'ك', 'هـ', 'ف'];
  }

  while (questions.length < 8 && copyLettres.length > 0) {
    const i = Math.floor(Math.random() * copyLettres.length);
    questions.push(copyLettres.splice(i, 1)[0]);
  }
}

function genererOptions(correct) {
  let opts = [correct];
  let lettresRestantes = lettres.filter(l => l !== correct);
  let nbOptions = niveau === 'difficile' ? 5 : 4;

  while (opts.length < nbOptions) {
    const l = lettresRestantes.splice(Math.floor(Math.random() * lettresRestantes.length), 1)[0];
    if (!opts.includes(l)) opts.push(l);
  }

  return opts.sort(() => Math.random() - 0.5);
}

function afficherQuestion() {
  clearTimeout(timer);
  if (index >= questions.length) {
    afficherScore();
    return;
  }

  document.getElementById('resultat').innerText = '';
  const question = questions[index];
  document.getElementById('question').innerText = `Trouve la lettre : ${question}`;

  const options = genererOptions(question);
  document.getElementById('options').innerHTML = '';
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.innerText = opt;
    btn.className = 'option-btn';
    btn.onclick = () => {
      clearTimeout(timer);
      verifierReponse(opt, question);
    };
    document.getElementById('options').appendChild(btn);
  });

  if (niveau === 'difficile') {
    // chrono 7 secondes
    timer = setTimeout(() => {
      document.getElementById('resultat').innerText = '⏰ Temps écoulé !';
      index++;
      setTimeout(afficherQuestion, 1500);
    }, 7000);
  }
}

function verifierReponse(selected, correct) {
  if (selected === correct) {
    bonnesReponses++;
    document.getElementById('resultat').innerText = '✅ Correct !';
  } else {
    document.getElementById('resultat').innerText = '❌ Incorrect !';
  }
  index++;
  setTimeout(afficherQuestion, 1000);
}

function afficherScore() {
  document.getElementById('jeu').style.display = 'none';
  document.getElementById('fin').style.display = 'block';
  document.getElementById('score').innerText = `Ton score : ${bonnesReponses} / 8`;
}
</script>

